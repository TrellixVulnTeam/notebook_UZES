## 进程的五种状态

linux上进程有5种状态:

- 运行(正在运行或在运行队列中等待)
- 中断(休眠中, 受阻, 在等待某个条件的形成或接受到信号)
- 不可中断(收到信号不唤醒和不可运行, 进程必须等待直到有中断发生)
- 僵死(进程已终止, 但进程描述符存在, 直到父进程调用wait4()系统调用后释放)
- 停止(进程收到SIGSTOP, SIGTSTP, SIGTTIN, SIGTTOU信号后停止运行运行)

ps工具标识进程的5种状态码:

- D 不可中断 uninterruptible sleep (usually IO)
- R 运行 runnable (on run queue)
- S 中断 sleeping
- T 停止 traced or stopped
- Z 僵死 a defunct (”zombie”) process


使用进程管理工具，我们可以查询程序当前的运行状态，或终止一个进程；

## ps 命令

### 命令参数

```
a 显示所有进程
-a 显示同一终端下的所有程序
-A 显示所有进程
c 显示进程的真实名称
-N 反向选择
-e 等于“-A”
e 显示环境变量
f 显示程序间的关系
-H 显示树状结构
r 显示当前终端的进程
T 显示当前终端的所有程序
u 指定用户的所有进程
-au 显示较详细的资讯
-aux 显示所有包含其他使用者的进程
-C<命令> 列出指定命令的状况
–lines<行数> 每页显示的行数
–width<字符数> 每页显示的字符数
–help 显示帮助信息
–version 显示版本显示
```

### 输出列的含义

```
F 代表这个程序的旗标 (flag)， 4 代表使用者为 super user
S 代表这个程序的状态 (STAT)，关于各 STAT 的意义将在内文介绍
UID 程序被该 UID 所拥有
PID 进程的ID
PPID 则是其上级父程序的ID
C CPU 使用的资源百分比
PRI 这个是 Priority (优先执行序) 的缩写，详细后面介绍
NI 这个是 Nice 值，在下一小节我们会持续介绍
ADDR 这个是 kernel function，指出该程序在内存的那个部分。如果是个 running的程序，一般就是 “-“
SZ 使用掉的内存大小
WCHAN 目前这个程序是否正在运作当中，若为 - 表示正在运作
TTY 登入者的终端机位置
TIME 使用掉的 CPU 时间。
CMD 所下达的指令为何
```


## 查询归属于用户colin115的进程

```
$ps -aux | grep colin115
```

## 列出这次登入的PID相关信息

```
ps -l
```


## 查询进程ID

（适合只记得部分进程字段）

```
$pgrep 查找进程

eg:查询进程名中含有re的进程
$pgrep -l re
```


## 杀死相关进程

kill -9 3434

## 进程监控

查看系统中使用CPU、使用内存最多的进程；

```
$top
(->)P
输入top命令后，进入到交互界面；接着输入字符命令后显示相应的进程状态：
```

对于进程，平时我们最常想知道的就是哪些进程占用CPU最多，占用内存最多。以下两个命令就可以满足要求:

- P：根据CPU使用百分比大小进行排序。
- M：根据驻留内存大小进行排序。
- i：使top不显示任何闲置或者僵死进程。

### %id：空闲CPU时间百分比

如果这个值过低，表明系统CPU存在瓶颈；

### %wa：等待I/O的CPU时间百分比

如果这个值过高，表明IO存在瓶颈；

-------------------
**综合运用**

- 将用户colin115下的所有进程名以av_开头的进程终止:

```
ps -u colin115 |  awk '/av_/ {print "kill -9 " $1}' | sh
```
- 将用户colin115下所有进程名中包含HOST的进程终止:

```
ps -fe| grep colin115|grep HOST |awk '{print $2}' | xargs kill -9;
```
